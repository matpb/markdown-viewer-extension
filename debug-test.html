<!DOCTYPE html>
<html>
<head>
  <title>Markdown Debug Test</title>
  <script src="lib/marked.min.js"></script>
  <script src="lib/prism.js"></script>
  <link rel="stylesheet" href="lib/prism.css">
</head>
<body>
  <h1>Debug Test</h1>
  <div id="error"></div>
  <div id="output"></div>

  <script>
    // Test markdown parsing
    const testMarkdown = `# Test

\`\`\`python
def hello():
    print("world")
\`\`\`
`;

    try {
      marked.setOptions({
        gfm: true,
        breaks: true,
        headerIds: true,
        mangle: false,
        pedantic: false,
        smartLists: true,
        smartypants: true,
        xhtml: false
      });

      const renderer = new marked.Renderer();
      const originalCodeRenderer = renderer.code;

      renderer.code = function(code, language) {
        console.log('Rendering code block:', language, code.substring(0, 50));
        if (language && Prism.languages[language]) {
          try {
            const highlighted = Prism.highlight(code, Prism.languages[language], language);
            return `<pre class="language-${language}"><code class="language-${language}">${highlighted}</code></pre>`;
          } catch (e) {
            console.error('Prism error:', e);
          }
        }
        return originalCodeRenderer.call(this, code, language);
      };

      marked.use({ renderer });

      const html = marked.parse(testMarkdown);
      document.getElementById('output').innerHTML = html;
      console.log('Success!');
    } catch (e) {
      document.getElementById('error').textContent = 'Error: ' + e.message;
      console.error('Full error:', e);
    }
  </script>
</body>
</html>
